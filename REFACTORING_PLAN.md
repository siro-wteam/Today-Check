# 리팩토링 전략 (안전한 작은 단위)

## 원칙

1. **한 번에 하나만**  
   한 번에 한 종류의 변경만 수행 (예: 백업 파일 삭제만, 또는 한 파일의 unused import 정리만).

2. **매 단계 후 검증**  
   각 단계 끝에 `npm run lint` 실행하고, 필요하면 앱 실행/빌드로 동작 확인.

3. **되돌리기 쉬우면**  
   단계별로 커밋해서 문제 생기면 `git revert` 한 번으로 롤백 가능하게.

4. **동작/타입은 유지**  
   리팩토링은 구조·가독성만 바꾸고, 동작과 타입 시그니처는 그대로 유지.

---

## 단계별 계획

### Phase 0: 기준선 잡기 (필수)

- [x] `npm run lint` 실행 → **기준선**: 3 errors, 52 warnings (2025-02). Phase 2-0에서 에러 3개만 먼저 수정 권장.
- [ ] (선택) `git tag refactor-baseline` 또는 브랜치 생성.

**목적**: 이후 단계에서 “이 단계 때문에 깨졌다”를 구분하기 위함.

---

### Phase 1: 사용하지 않는 파일 제거 (가장 안전)

- [x] **1-1**  
  아래 4개 백업 파일 삭제 완료.  
  (어디서도 import 하지 않음 → 동작 영향 없음.)

  - ~~`app/(tabs)/index.tsx.backup`~~
  - ~~`components/EditTaskBottomSheet.tsx.backup`~~
  - ~~`lib/api/groups.backup.ts`~~
  - ~~`lib/hooks/use-timeline-tasks.backup.ts`~~

- [ ] `npm run lint` 실행 → 통과 확인 후 커밋.

---

### Phase 2: 저위험 정리 (한 번에 한 파일 또는 한 종류만)

각 항목을 **별도 커밋**으로 진행.

- [ ] **2-1**  
  한 파일씩 **unused import 제거** (eslint fix 또는 수동).  
  대상: 자주 쓰는 화면/훅/API 파일부터.

- [ ] **2-2**  
  **중복 상수**가 있으면 한 곳으로 모으기 (예: 매직 넘버/문자열을 `constants/` 또는 해당 모듈 상단으로).  
  한 파일·한 상수 종류 단위로 진행.

- [ ] **2-3**  
  **같은 로직이 2곳 이상**에 있으면, 먼저 한 곳만 작은 유틸/헬퍼로 추출하고, 다른 쪽은 그대로 두었다가 다음 커밋에서 치환.

---

### Phase 3: 큰 파일 나누기 (신중하게)

아래 파일들은 라인 수가 많음. **한 파일당 한 번에 한 개의 작은 추출만** 권장.

| 파일 | 대략 라인 수 | 추출 후보 (예시만, 순서 무관) |
|------|--------------|----------------------------------|
| `lib/api/tasks.ts` | ~1500 | 쿼리 빌더/타입만 분리, 또는 “오늘/백로그” 전용 함수만 별 파일로 |
| `app/day.tsx` | ~1500 | 헤더/섹션 컴포넌트만 먼저 분리 |
| `app/group-detail.tsx` | ~1500 | 상단 정보 영역만 컴포넌트로 |
| `app/(tabs)/index.tsx` | ~1300 | 롤오버/오늘/완료 섹션을 각각 작은 컴포넌트로 |
| `components/EditTaskBottomSheet.tsx` | ~1100 | 폼 필드 묶음만 먼저 분리 |
| `app/(tabs)/backlog.tsx` | ~760 | 리스트 아이템/필터 UI만 먼저 분리 |
| `lib/api/groups.ts` | ~730 | 타입/상수와 API 함수 분리 등 |

**규칙**  
- 한 번에 **한 개의 컴포넌트/함수/타입 그룹**만 새 파일로 빼기.  
- 빼낸 뒤 **기존 파일에서는 import만 추가**하고, 나머지 로직은 다음 단계에서 정리.

---

### Phase 4: 타입/테스트 강화 (선택)

- [ ] `tsconfig.json`에서 `strict: true` 등은 **한 옵션씩** 켜고, 나오는 에러만 해당 파일에서만 수정 후 커밋.
- [ ] 테스트 추가는 “새로 추출한 유틸/훅” 위주로, 리팩토링과 별도 커밋.

---

## 진행 순서 요약

1. **Phase 0** → lint 통과, 기준선 태그/브랜치.
2. **Phase 1** → 백업 파일 4개 삭제 후 lint + 커밋.
3. **Phase 2** → unused import / 상수 / 작은 유틸 추출을 **한 종류·한 파일 단위**로 반복 (각각 lint + 커밋).
4. **Phase 3** → 큰 파일은 **한 번에 한 추출**만 하고, 매번 lint + 실행 확인 + 커밋.
5. **Phase 4** → 필요할 때만, 한 설정/한 파일 단위로 진행.

문제가 생기면 해당 단계 커밋만 `git revert` 하고, 원인 파악 후 같은 원칙으로 다시 작은 단위로 나눠 진행하면 됩니다.
