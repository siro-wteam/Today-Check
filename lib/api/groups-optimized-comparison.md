# Group Members ìµœì í™” ë¶„ì„

## ğŸš¨ ë°œê²¬ëœ ë¬¸ì œ: N+1 Query Problem

### í˜„ì¬ ì½”ë“œ (lib/api/groups.ts:192-197)

```typescript
for (const groupRow of groupsData || []) {
  // âŒ ê° ê·¸ë£¹ë§ˆë‹¤ ë³„ë„ API í˜¸ì¶œ!
  const { data: membersData } = await supabase
    .from('group_members')
    .select('*')
    .eq('group_id', groupRow.id);  // Në²ˆ ë°˜ë³µ
}
```

### ë¬¸ì œì 

| ê·¸ë£¹ ìˆ˜ | API í˜¸ì¶œ íšŸìˆ˜ | ë¹„ê³  |
|---------|---------------|------|
| 1ê°œ | 1íšŒ | ë¬¸ì œ ì—†ìŒ |
| 2ê°œ | 2íšŒ | **í˜„ì¬ ìƒíƒœ** |
| 5ê°œ | 5íšŒ | ì ì  ëŠë ¤ì§ |
| 10ê°œ | 10íšŒ | ë§¤ìš° ëŠë¦¼ |
| 20ê°œ | 20íšŒ | ì‚¬ìš© ë¶ˆê°€ ìˆ˜ì¤€ |

**ë³µì¡ë„: O(N)** - ê·¸ë£¹ì´ ë§ì„ìˆ˜ë¡ ê¸°í•˜ê¸‰ìˆ˜ì ìœ¼ë¡œ ëŠë ¤ì§

---

## âœ… ìµœì í™” ë°©ì•ˆ

### ë°©ë²• 1: IN ì¿¼ë¦¬ë¡œ ì¼ê´„ ì¡°íšŒ (ê¶Œì¥)

```typescript
// í•œ ë²ˆì— ëª¨ë“  ê·¸ë£¹ì˜ ë©¤ë²„ ê°€ì ¸ì˜¤ê¸°
const { data: allMembersData } = await supabase
  .from('group_members')
  .select('*')
  .in('group_id', groupIds);  // 1ë²ˆ í˜¸ì¶œ!

// í´ë¼ì´ì–¸íŠ¸ì—ì„œ ê·¸ë£¹ë³„ë¡œ ë¶„ë¥˜
const membersByGroup = new Map<string, GroupMemberRow[]>();
allMembersData?.forEach(member => {
  if (!membersByGroup.has(member.group_id)) {
    membersByGroup.set(member.group_id, []);
  }
  membersByGroup.get(member.group_id)!.push(member);
});

// ê° ê·¸ë£¹ì— ë©¤ë²„ í• ë‹¹
for (const groupRow of groupsData) {
  const membersData = membersByGroup.get(groupRow.id) || [];
  // ... í”„ë¡œí•„ enrichment
}
```

**ì¥ì :**
- API í˜¸ì¶œ: Në²ˆ â†’ 1ë²ˆ (90%+ ê°ì†Œ)
- ë„¤íŠ¸ì›Œí¬ ë ˆì´í„´ì‹œ ëŒ€í­ ê°ì†Œ
- Supabase ë¹„ìš© ì ˆê°

**ë‹¨ì :**
- ì•½ê°„ì˜ í´ë¼ì´ì–¸íŠ¸ ë¡œì§ ì¶”ê°€ (ë¬´ì‹œí•  ìˆ˜ì¤€)

---

### ë°©ë²• 2: JOINì„ ì‚¬ìš©í•œ ì¤‘ì²© ì¡°íšŒ

```typescript
// Supabaseì˜ nested select í™œìš©
const { data: groupsData } = await supabase
  .from('groups')
  .select(`
    *,
    group_members (*)
  `)
  .in('id', groupIds);
```

**ì¥ì :**
- ë” ê°„ê²°í•œ ì½”ë“œ
- Supabaseê°€ ìë™ìœ¼ë¡œ ìµœì í™”

**ë‹¨ì :**
- ì¤‘ì²© êµ¬ì¡° íŒŒì‹± í•„ìš”
- í”„ë¡œí•„ enrichment ë³„ë„ ì²˜ë¦¬ í•„ìš”

---

## ğŸ“Š ì„±ëŠ¥ ë¹„êµ

### ê·¸ë£¹ 10ê°œ ê¸°ì¤€

| ë°©ì‹ | API í˜¸ì¶œ | ì‘ë‹µ ì‹œê°„ | ê°œì„ ìœ¨ |
|------|----------|-----------|--------|
| **í˜„ì¬ (N+1)** | 10íšŒ | ~1,500ms | - |
| **ìµœì í™” (IN)** | 1íšŒ | ~150ms | **90% ë¹ ë¦„** |

### ì‹¤ì œ ì¸¡ì • (ì˜ˆìƒ)

```
í˜„ì¬:
  â”œâ”€ group_members (group1)   150ms
  â”œâ”€ group_members (group2)   150ms
  â”œâ”€ ...
  â””â”€ group_members (group10)  150ms
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Total: ~1,500ms

ìµœì í™”:
  â””â”€ group_members (IN query) 150ms
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Total: ~150ms (10ë°° ë¹ ë¦„!)
```

---

## ğŸ¯ ì¶”ì²œ ì‚¬í•­

**ì¦‰ì‹œ ì ìš© í•„ìˆ˜!**

ì´ìœ :
1. **í™•ì¥ì„± ë¬¸ì œ**: ê·¸ë£¹ì´ ëŠ˜ì–´ë‚ ìˆ˜ë¡ ì‹¬ê°í•´ì§
2. **ì‚¬ìš©ì ê²½í—˜**: ë¡œë”© ì‹œê°„ 10ë°° ê°œì„ 
3. **ë¹„ìš© ì ˆê°**: Supabase API í˜¸ì¶œ 90% ê°ì†Œ
4. **ê°„ë‹¨í•œ ìˆ˜ì •**: ì½”ë“œ ë³€ê²½ì´ í¬ì§€ ì•ŠìŒ

---

## ğŸ”„ ë§ˆì´ê·¸ë ˆì´ì…˜ ë‹¨ê³„

1. **ë°±ì—…**: ê¸°ì¡´ `lib/api/groups.ts` ë³µì‚¬
2. **ìµœì í™”**: `fetchMyGroups()` í•¨ìˆ˜ ìˆ˜ì •
3. **í…ŒìŠ¤íŠ¸**: ê·¸ë£¹ ëª©ë¡ ë¡œë”© í™•ì¸
4. **ì¸¡ì •**: ë„¤íŠ¸ì›Œí¬ íƒ­ì—ì„œ í˜¸ì¶œ íšŸìˆ˜ í™•ì¸
5. **ëª¨ë‹ˆí„°ë§**: ì¼ì£¼ì¼ê°„ ì—ëŸ¬ ì²´í¬
