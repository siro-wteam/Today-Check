# 구독(무료/유료) 제한 적용 복잡도 예측

## 1. 대표 상수 (적용 완료)

`constants/subscription.ts`에서 한 곳에 관리:

| 상수 | 의미 | 무료 제한 |
|------|------|-----------|
| `FREE_MAX_GROUPS` | 그룹 최대 개수 | 2 |
| `FREE_MAX_BACKLOG` | 백로그(due_date null) 최대 개수 | 5 |
| `FREE_MAX_TASKS_PER_DATE` | 날짜당 일감 최대 개수 (해당 due_date 기준, 연기 포함) | 5 |
| `PAID_UNLIMITED` | 유료 = 제한 없음 | Infinity |

추후 숫자만 바꾸면 됨.

---

## 2. 필요한 전제

- **구독 상태 소스**: 유저가 무료인지 유료인지 알 수 있어야 함.
  - 예: Supabase `profiles.subscription_tier` 또는 `subscriptions` 테이블, 또는 RevenueCat 등 외부 결제 연동.
- **헬퍼**: `isSubscribed(userId)` 또는 `getSubscriptionTier(userId)` 같은 함수 하나 두고, 유료면 제한 검사 생략.

---

## 3. 제한이 걸리는 지점 (무료일 때만 검사)

| 제한 | 검사 시점 | 난이도 |
|------|-----------|--------|
| **그룹 최대 개수** | 그룹 생성 API/화면 직전 | 낮음 |
| **하루 일감 생성 수** | 일감 생성 API/화면 직전 (오늘 이미 만든 개수 카운트) | 중간 |
| **백로그 최대 개수** | (1) 일감 생성 시 due_date=null 로 만들 때, (2) 기존 일감을 “백로그로 이동”할 때 | 중간 |
| **오늘 일정 최대 개수** | (1) 일감 생성 시 due_date=오늘 로 만들 때, (2) “오늘로 예약” / “오늘로 연기”할 때 | 중간 |

---

## 4. 복잡도 예측 (요약)

- **전체**: **중간(Medium)** 수준.
- 상수로 관리했기 때문에 “숫자 변경”은 쉬움. 복잡한 부분은 **언제, 어디서, 어떻게 세고 막을지**와 **구독 상태를 어디서 가져올지**다.

### 낮은 복잡도

- **그룹 최대 개수**
  - 그룹 생성 직전에 “내가 만든 그룹 수”만 세면 됨 (이미 그룹 목록 API 있음).
  - 무료이고 `count >= FREE_MAX_GROUPS`면 생성 버튼 비활성화 + API에서 403 등으로 차단.

### 중간 복잡도

- **하루 일감 생성 수**
  - “오늘 날짜 기준으로 생성된 일감 수”를 세야 함.
  - 선택지: (1) `tasks.created_at`이 오늘인 개수로 카운트, (2) 별도 `daily_task_creation_count` 같은 통계 테이블/필드.
  - 일감 생성 API/클라이언트에서 “오늘 이미 5개 생성됨”이면 생성 불가 처리.

- **백로그 최대 개수**
  - `due_date IS NULL`인 일감 개수만 세면 됨 (개인 + 내가 속한 그룹 중 “내가 생성” 또는 “내가 담당” 등 정책에 맞게).
  - 검사 위치: (1) 새 일감을 백로그(due_date null)로 만들 때, (2) 기존 일감을 “백로그로 이동”할 때.
  - 무료이고 이미 5개면 “백로그로 이동” 비활성화 + API에서 거부.

- **오늘 일정 최대 개수**
  - “오늘(due_date = today)에 들어가는 일감 개수”를 세면 됨 (연기로 오늘로 들어온 것 포함, 이미 같은 로직으로 “오늘” 리스트를 쓰고 있음).
  - 검사 위치: (1) 새 일감을 오늘로 만들 때, (2) “오늘로 예약”, “오늘로 연기” 등 due_date를 오늘로 바꾸는 모든 경로.
  - 무료이고 오늘 이미 5개면 해당 액션 비활성화 + API에서 거부.

### 추가로 고려할 점

- **구독 상태**:  
  - DB 컬럼/테이블만 있으면 단순.  
  - RevenueCat 등 연동하면 초기 설정 + 콜백/웹훅 처리로 난이도 약간 증가.
- **시간대**: “오늘” / “하루”는 서버 기준 UTC인지, 사용자 로컬 날짜인지 정해야 함. (보통 사용자 로컬 날짜로 통일하는 경우 많음.)
- **그룹 일감**: “일감 5개”는 “내가 만든 개인 일감 + 내가 만든/담당하는 그룹 일감” 전체인지, 개인만인지 정책 결정 필요.

---

## 5. 작업 순서 제안

1. **구독 상태 저장**  
   - 예: `profiles.subscription_tier` ('free' | 'paid') 또는 별도 테이블.
2. **헬퍼**  
   - `isSubscribed(userId)` (또는 tier 반환) 구현.
3. **그룹 생성**  
   - 무료일 때 그룹 개수 >= `FREE_MAX_GROUPS` 이면 막기 (클라이언트 + API).
4. **일감 생성**  
   - 무료일 때 “오늘 생성 수” / “백로그 수” / “오늘 일정 수” 검사 후 생성 허용/거부.
5. **백로그로 이동 / 오늘로 예약·연기**  
   - 무료일 때 “백로그 개수” / “오늘 일정 개수” 검사 후 허용/거부.

상수는 이미 두었으므로, 위 순서대로 “검사 시점”과 “구독 상태”만 붙이면 적용 가능하다.
